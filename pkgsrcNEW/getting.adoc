= Chapter 3. Where to get pkgsrc and how to keep it up-to-date
:toc:
:toc: left
:toclevels: 4
:icons: font
:docinfo: private

Before you download and extract the files, you need to decide where you want to extract them. When using pkgsrc as root user, pkgsrc is usually installed in ``/usr/pkgsrc``. You are though free to install the sources and binary packages wherever you want in your filesystem, provided that the pathname does not contain white-space or other characters that are interpreted specially by the shell and some other programs. A safe bet is to use only letters, digits, underscores and dashes.

== 3.1. Getting pkgsrc for the first time

Before you download any pkgsrc files, you should decide whether you want the __current__ branch or the __stable__ branch. The latter is forked on a 	quarterly basis from the current branch and only gets modified for security updates. The names of the stable branches are built from the year and the quarter, for example `2021Q4`.

The second step is to decide __how__ you want to download pkgsrc. You can get it as a tar file or via CVS. Both ways are described here.

Note that tar archive contains CVS working copy.
Thus you can switch to using CVS at any later time.


===  3.1.1. As tar archive

The primary download location for all pkgsrc files is https://cdn.NetBSD.org/pub/pkgsrc/[https://cdn.NetBSD.org/pub/pkgsrc/] or ftp://ftp.NetBSD.org/pub/pkgsrc/[ftp://ftp.NetBSD.org/pub/pkgsrc/] (it points to the same location). There are a number of subdirectories for different purposes,which are described in detail in http://netbsd.org/docs/pkgsrc/ftp-layout.html[Appendix D, Directory layout of the pkgsrc FTP server].

The tar archive for the current branch is in the directory ``current`` and is called https://cdn.NetBSD.org/pub/pkgsrc/current/pkgsrc.tar.gz[``pkgsrc.tar.gz``]. It is autogenerated weekly.

To save download time we provide bzip2- and	xz-compressed archives which are published at https://cdn.NetBSD.org/pub/pkgsrc/current/pkgsrc.tar.bz2[``pkgsrc.tar.bz2``] and https://cdn.NetBSD.org/pub/pkgsrc/current/pkgsrc.tar.xz[``pkgsrc.tar.xz``] respectively.

You can fetch the same files using FTP.

The tar file for the stable branch 2021Q4 is in the	directory ``pkgsrc-2021Q4`` and is also called https://cdn.NetBSD.org/pub/pkgsrc/pkgsrc-2021Q4/pkgsrc.tar.gz[``pkgsrc.tar.gz``].

To download the latest pkgsrc stable tarball, run:
    
    $ ftp ftp://ftp.NetBSD.org/pub/pkgsrc/pkgsrc-2021Q4/pkgsrc.tar.gz
    

If you prefer, you can also fetch it using "wget", "curl", or your web browser.

Then, extract it with:

    $ tar -xzf pkgsrc.tar.gz -C /usr
    

This will create the directory ``pkgsrc/`` in ``/usr/`` and all the package source will be stored under ``/usr/pkgsrc/``.

To download pkgsrc-current, run:

    $ ftp ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc.tar.gz
    
===  3.1.2. Via anonymous CVS

To fetch a specific pkgsrc stable branch, run:

    $ cd /usr && cvs -q -z2 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -r pkgsrc-2021Q4 -P pkgsrc
    

This will create the directory ``pkgsrc/``in your ``/usr/`` directory and all the package source will be stored under ``/usr/pkgsrc/``.

To fetch the pkgsrc current branch, run:
    
    $ cd /usr && cvs -q -z2 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -P pkgsrc
    

Refer to the https://www.NetBSD.org/mirrors/#anoncvs[list of available mirrors] to choose a faster CVS mirror, if needed.

If you get error messages from ``rsh``, you need to set CVS_RSH variable. E.g.:

    $ cd /usr && env CVS_RSH=ssh cvs -q -z2 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -P pkgsrc
    
    

Refer to documentation on your command shell how to set CVS_RSH=ssh permanently.For Bourne shells, you can set it in your ``.profile`` or better globally in ``/etc/profile``:

    # set CVS remote shell command
    CVS_RSH=ssh
    export CVS_RSH
    

By default, CVS doesn't do things like most people would expect it to do. But there is a way to convince CVS, by creating a file called ``.cvsrc`` in your home directory and saving the following lines to it. This file will save you lots of headache and some bug reports, so we strongly recommend it. You can find an explanation of this file in the CVS documentation.

    # recommended CVS configuration file from the pkgsrc guide
    cvs -q
    checkout -P
    update -dP
    diff -upN
    rdiff -u
    release -d
    
==  3.2. Keeping pkgsrc up-to-date
The preferred way to keep pkgsrc up-to-date is via CVS (which also works if you have first installed it via a tar file). It saves bandwidth and hard disk activity, compared to downloading the tar file again.

===  3.2.1. Via tar files


WARNING: **WARNING**. When updating from a tar file, you first need to completely remove the old pkgsrc directory. Otherwise those files that have been removed from pkgsrc in the mean time will not be removed on your local disk, resulting in inconsistencies. When removing the old files, any changes that you have done to the pkgsrc files will be lost after updating. Therefore updating via CVS is strongly recommended.


Note that by default the distfiles and the binary packages are saved in the pkgsrc tree, so don't forget to rescue them before updating. You can also configure pkgsrc to store distfiles and packages in directories outside the pkgsrc tree by setting the ``DISTDIR`` and ``PACKAGES`` variables. See http://netbsd.org/docs/pkgsrc/configuring.html[Chapter 6, Configuring pkgsrc] for the details.

To update pkgsrc from a tar file, download the tar file as explained above. Then, make sure that you have not made any changes to the files in the pkgsrc directory. Remove the pkgsrc	directory and extract the new tar file. Done.

===  3.2.2. Via CVS

To update pkgsrc via CVS, change to the ``pkgsrc`` directory and run cvs:

    $ cd /usr/pkgsrc && cvs update -dP
    

If you get error messages from ``rsh``, you need to set CVS_RSH variable as described above. E.g.:

    $ cd /usr/pkgsrc && env CVS_RSH=ssh cvs up -dP
    
====  3.2.2.1. Switching between different pkgsrc branches

When updating pkgsrc, the CVS program keeps track of the branch you selected. But if you, for whatever reason, want to switch from the stable branch to the current one, you can do it by adding the option “-A” after the “update” keyword. To switch from the current branch back to the stable branch, add the “-rpkgsrc-2021Q4” option.

====  3.2.2.2. What happens to my changes when updating?

When you update pkgsrc, the CVS program will only touch those files that are registered in the CVS repository. That means that any packages that you created on your own will stay unmodified. If you change files that are managed by CVS, later updates will try to merge your changes with those that have been done by others. See the CVS manual, chapter “update” for details.
