<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Chapter 8. Creating binary packages for everything in pkgsrc (bulk builds)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<style>

.previous {
    text-decoration: none;
    display: inline-block;
    padding: 9px 16px;
    background-color: #f1f1f1;
    color: black;
}
.index {
    text-decoration: none;
    display: inline-block;
    padding: 9px 16px;
    background-color: #f1f1f1;
    color: black;

}
.next {
    text-decoration: none;
    display: inline-block;
    padding: 9px 16px;
    background-color: #FF4500;
    color: white;
    float: right !important;}

#myBtn {
  #display: none; /* Hidden by default */
  position: fixed; /* Fixed/sticky position */
  bottom: 20px; /* Place the button at the bottom of the page */
  right: 30px; /* Place the button 30px from the right */
  z-index: 99; /* Make sure it does not overlap */
  border: none; /* Remove borders */
  outline: none; /* Remove outline */
  background-color: #FF4500; /* Set a background color */
  color: white; /* Text color */
  cursor: pointer; /* Add a mouse pointer on hover */
  padding: 15px; /* Some padding */
  border-radius: 10px; /* Rounded corners */
  font-size: 18px; /* Increase font size */
}

#myBtn:hover {
  background-color: #555; /* Add a dark-grey background on hover */
}

</style>
<script>
//Get the button
var mybutton = document.getElementById("myBtn");

// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}

// When the user clicks on the button, scroll to the top of the document
function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>


<a href="https://jaypatelani.github.io/trydocs/pkgsrc/chapter-07.html" class="previous">&laquo; Previous</a>
<a href="https://jaypatelani.github.io/trydocs/pkgsrc/index.html" class="previous">&laquo; Index</a>
<a href="https://jaypatelani.github.io/trydocs/pkgsrc/chapter-09.html" class="next">Next &raquo;</a>

<button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
<div id="header">
<h1>Chapter 8. Creating binary packages for everything in pkgsrc (bulk builds)</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_8_1_preparations">8.1. Preparations</a></li>
<li><a href="#_8_2_running_a_bulk_build">8.2. Running a bulk build</a>
<ul class="sectlevel2">
<li><a href="#_8_2_1_configuration">8.2.1. Configuration</a></li>
</ul>
</li>
<li><a href="#_8_3_requirements_of_a_full_bulk_build">8.3. Requirements of a full bulk build</a></li>
<li><a href="#_8_4_bulk_build_variants">8.4. Bulk build variants</a>
<ul class="sectlevel2">
<li><a href="#_8_4_1_detect_unknown_configure_options">8.4.1. Detect unknown configure options</a></li>
<li><a href="#_8_4_2_detect_classes_of_bugs_by_forcing_compiler_warnings">8.4.2. Detect classes of bugs by forcing compiler warnings</a></li>
<li><a href="#_8_4_3_force_compiler_options_only_in_the_build_phase">8.4.3. Force compiler options only in the build phase</a></li>
<li><a href="#_8_4_4_use_custom_directories">8.4.4. Use custom directories</a></li>
<li><a href="#_8_4_5_turn_warnings_into_errors">8.4.5. Turn warnings into errors</a></li>
<li><a href="#_8_4_6_reject_packages_for_which_pkglint_reports_errors">8.4.6. Reject packages for which pkglint reports errors</a></li>
<li><a href="#_8_4_7_reject_packages_that_contain_forbidden_strings">8.4.7. Reject packages that contain forbidden strings</a></li>
<li><a href="#_8_4_8_reject_packages_whose_self_test_fails">8.4.8. Reject packages whose self-test fails</a></li>
<li><a href="#_8_4_9_reject_packages_that_use_undefined_shell_variables">8.4.9. Reject packages that use undefined shell variables</a></li>
<li><a href="#_8_4_10_turn_off_verbose_logging">8.4.10. Turn off verbose logging</a></li>
</ul>
</li>
<li><a href="#_8_5_creating_a_multiple_cd_rom_packages_collection">8.5. Creating a multiple CD-ROM packages collection</a>
<ul class="sectlevel2">
<li><a href="#_8_5_1_example_of_cdpack">8.5.1. Example of cdpack</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>For a number of reasons, you may want to build binary packages for a large selected set of packages in pkgsrc, or even for all pkgsrc packages. For instance, when you have multiple machines that should run the same software, it is wasted time if they all build their packages themselves from source. Or you may want to build a list of packages you want and check them before deploying onto production systems. There is a way of getting a set of binary packages: the bulk build system, or pbulk ("p" stands for "parallel"). This chapter describes how to set it up.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_8_1_preparations">8.1. Preparations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First of all, you have to decide whether you build all packages
or a limited set of them. Full bulk builds usually consume a lot more resources, both space and time, than builds for some practical sets of packages. A number of particularly heavy packages exist that are not actually interesting to a wide audience. (The approximate resource consumption for a full bulk build is given in section <a href="https://www.netbsd.org/docs/pkgsrc/bulk.html#bulk.req">Section 8.3, “Requirements of a full bulk build”</a>.) For limited bulk builds you need to make a list of packages you want to build.
Note that all their dependencies will be built, so you don&#8217;t need to track them manually.</p>
</div>
<div class="paragraph">
<p>During bulk builds various packages are installed and deinstalled
in <code>/usr/pkg</code> (or whatever <code>LOCALBASE</code> is), so make sure that you don&#8217;t need any package during the builds. Essentially, you should provide a fresh system, either a chroot environment
or something even more restrictive, depending on what the operating system provides, or dedicate the whole physical machine. As a useful side effect this makes sure that bulk builds cannot break anything in your system. There have been numerous cases where certain packages tried to install files outside the
<code>LOCALBASE</code> or wanted to edit some files in <code>/etc</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_8_2_running_a_bulk_build">8.2. Running a bulk build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Running a bulk build works roughly as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, build the pbulk infrastructure in a fresh pkgsrc location.</p>
</li>
<li>
<p>Then, build each of the packages from a clean installation directory using the infrastructure.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_8_2_1_configuration">8.2.1. Configuration</h3>
<div class="paragraph">
<p>To simplify configuration, we provide the helper script <code>mk/pbulk/pbulk.sh</code>.</p>
</div>
<div class="paragraph">
<p>In order to use it, prepare a clear system (real one, chroot environment, jail, zone, virtual machine). Configure network access to fetch distribution files. Create a user with name "pbulk".</p>
</div>
<div class="paragraph">
<p>Fetch and extract pkgsrc. Use a command like one of these:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># (cd /usr &amp;&amp; ftp -o - https://cdn.NetBSD.org/pub/pkgsrc/current/pkgsrc.tar.gz | tar -zxf-)
# (cd /usr &amp;&amp; fetch -o - https://cdn.NetBSD.org/pub/pkgsrc/current/pkgsrc.tar.gz | tar -zxf-)
# (cd /usr &amp;&amp; cvs -Q -z3 -d anoncvs@anoncvs.NetBSD.org:/cvsroot get -P pkgsrc)</pre>
</div>
</div>
<div class="paragraph">
<p>Or any other way that fits (e.g., curl, wget).</p>
</div>
<div class="paragraph">
<p>Deploy and configure pbulk tools, e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># sh pbulk.sh -n # use native make, no bootstrap kit needed (for use on NetBSD)
# sh pbulk.sh -n -c mk.conf.frag # native, apply settings from given mk.conf fragment
# sh pbulk.sh -nlc mk.conf.frag # native, apply settings, configure for limited build</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>mk.conf.frag</code> is a fragment of <code>mk.conf</code> that contains settings you want to apply to packages you build. For instance,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>PKG_DEVELOPER=          yes     # perform more checks
X11_TYPE=               modular # use pkgsrc X11
SKIP_LICENSE_CHECK=     yes     # accept all licences (useful
                                # when building all packages)</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If configured for limited list, replace the list in <code>/usr/pbulk/etc/pbulk.list</code> with your list of packages, one per line without empty lines or comments. E.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>www/firefox
mail/thunderbird
misc/libreoffice4</pre>
</div>
</div>
<div class="paragraph">
<p>At this point you can also review configuration in <code>/usr/pbulk/etc</code> and make final amendments, if wanted.</p>
</div>
<div class="paragraph">
<p>Start it:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># /usr/pbulk/bin/bulkbuild</pre>
</div>
</div>
<div class="paragraph">
<p>After it finishes, you&#8217;ll have <code>/mnt</code> filled with distribution files, binary packages, and reports, plain text summary in <code>/mnt/bulklog/meta/report.txt</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>pbulk.sh</code> script does not cover all possible use cases. While being ready to run, it serves as a good starting point to understand and build more complex setups. The script is kept small enough for better understanding.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>pbulk.sh</code> script supports running unprivileged bulk build and helps configuring distributed bulk builds. Distributed bulk builds support either building in worker chroots (each node is a path to a different chroot) that replicate the target system, including the pbulk prefix,
or remote machines (each node is an IP address that must be accessible over SSH without a password).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_8_3_requirements_of_a_full_bulk_build">8.3. Requirements of a full bulk build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A complete bulk build requires lots of disk space. Some of the disk space can be read-only, some other must be writable. Some can be on remote filesystems (such as NFS) and some should be local. Some can be temporary filesystems, others must survive a sudden reboot.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>70 GB for the distfiles (read-write, remote, temporary)</p>
</li>
<li>
<p>60 GB for the binary packages (read-write, remote, permanent)</p>
</li>
<li>
<p>1 GB for the pkgsrc tree (read-only, remote, permanent)</p>
</li>
<li>
<p>5 GB for <code>LOCALBASE</code> (read-write, local, temporary)</p>
</li>
<li>
<p>10 GB for the log files (read-write, remote, permanent)</p>
</li>
<li>
<p>5 GB for temporary files (read-write, local, temporary)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_8_4_bulk_build_variants">8.4. Bulk build variants</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To ensure that pkgsrc packages work in different configurations, it makes sense to run non-default bulk builds from time to time. This section lists some ideas for bulk builds that intentionally let packages fail if they don&#8217;t follow the pkgsrc style.</p>
</div>
<div class="sect2">
<h3 id="_8_4_1_detect_unknown_configure_options">8.4.1. Detect unknown configure options</h3>
<div class="paragraph">
<p>Add the following line to <a href="https://www.netbsd.org/docs/pkgsrc/configuring.html#mk.conf"><code>mk.conf</code></a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GNU_CONFIGURE_STRICT=   yes</pre>
</div>
</div>
<div class="paragraph">
<p>When a package fails this additional check, the most common cause is that the configure option was valid for an older version of the package but does not apply anymore. In that case, just remove it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_8_4_2_detect_classes_of_bugs_by_forcing_compiler_warnings">8.4.2. Detect classes of bugs by forcing compiler warnings</h3>
<div class="paragraph">
<p>The job of a compiler is not restricted to producing executable code, most compilers also detect typical programming mistakes. The pkgsrc compiler wrappers make it easy to force compiler options when the package is built. This can be used to find typical bugs across all packages that are in pkgsrc. By reporting these bugs upstream, the packages will be more reliable with the next updates.</p>
</div>
<div class="paragraph">
<p>Add some of the following lines to <a href="https://www.netbsd.org/docs/pkgsrc/configuring.html#mk.conf"><code>mk.conf</code></a>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CFLAGS+=        -Werror=char-subscripts
CFLAGS+=        -Werror=implicit-function-declaration</pre>
</div>
</div>
<div class="paragraph">
<p>When a package fails to build using these stricter compiler options, document the circumstances in which the compiler produced the error message. This includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The platform (<code>MACHINE_PLATFORM</code>)</p>
</li>
<li>
<p>The source file</p>
</li>
<li>
<p>An excerpt of the code. GCC and Clang already do this as part of the diagnostic.</p>
</li>
<li>
<p>The exact error message from the compiler.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a package produces these error messages, but the package is fine, record this in your local <a href="https://www.netbsd.org/docs/pkgsrc/configuring.html#mk.conf"><code>mk.conf</code></a>, like this, to skip this check in the next builds:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>.if ${PKGPATH} == category/package
# Version ${VERSION} failed on ${MACHINE_PLATFORM}:
# error message
# code
# Reason why the code does not need to be fixed.
BUILDLINK_TRANSFORM+=   rm:-Werror=char-subscripts
.endif</pre>
</div>
</div>
<div class="paragraph">
<p>If the error messages from the compiler are valid and the code needs to be fixed, prepare a local patch (see <code>LOCALPATCHES</code>) and report the bug to the upstream authors of the package, providing them with the information you collected above.</p>
</div>
<div class="paragraph">
<p>Patches that are not essential for the package to work should only be reported upstream but not committed to pkgsrc, to make future updates easier.</p>
</div>
</div>
<div class="sect2">
<h3 id="_8_4_3_force_compiler_options_only_in_the_build_phase">8.4.3. Force compiler options only in the build phase</h3>
<div class="paragraph">
<p>When adding custom compiler flags via <code>CFLAGS</code>, these apply to all phases of the package build process. Especially in the configure phase, adding <code>-Werror</code> leads to wrong decisions. The GNU configure scripts feed many small test programs to the C compiler to see whether certain headers are available, functions are defined in a library and programs can be run. In many cases these programs would not survive a strict compiler run with <code>-Wall -Wextra -Werror</code>.</p>
</div>
<div class="paragraph">
<p>The pkgsrc infrastructure is flexible enough to support compiler options being added between the <code>configure</code> and <code>build</code> phases. It&#8217;s a little more complicated than the other examples in this section but still easy enough.</p>
</div>
<div class="paragraph">
<p>The basic idea is to use the pkgsrc compiler wrapper to inject the desired compiler options. The compiler wrapper&#8217;s original task is to hide
unwanted directories of include files and to normalize compiler options.
It does this by wrapping the compiler command and rewriting the command
line. To see this in action, run <strong>bmake patch</strong> in a package directory and examine the <code>work/.cwrappers/config</code> directory. It contains individual configurations for the C compiler and the related tools.The
plan is to find a hook between the configure and build phases, and to
modify these configuration files at that point.</p>
</div>
<div class="paragraph">
<p>To find this hook, have a look at <code>mk/build/build.mk</code>, which contains among others the <code>pre-build-checks-hook</code>. The word <code>checks</code> doesn&#8217;t quite fit, but the <code>pre-build-hook</code> sounds good enough.</p>
</div>
<div class="paragraph">
<p>The code to be included in <a href="https://www.netbsd.org/docs/pkgsrc/configuring.html#mk.conf"><code>mk.conf</code></a> is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># Just a few example options.
BUILD_ONLY_CFLAGS=      -Wall -Werror -O2 -DTEMPDIR='"/tmp"'</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>.if ${BUILD_ONLY_CFLAGS:U:M*}
pre-build-checks-hook: add-build-only-cflags</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>add-build-only-cflags: .PHONY
    ${RUN} cd ${CWRAPPERS_CONFIG_DIR};      \
    ${TEST} ! -f ${.TARGET} || exit 0;      \
    for flag in ${BUILD_ONLY_CFLAGS}; do    \
            ${ECHO} "append=$$flag" &gt;&gt; cc;  \
    done;                                   \
    &gt; ${.TARGET}
.endif</pre>
</div>
</div>
<div class="paragraph">
<p>(When editing the <a href="https://www.netbsd.org/docs/pkgsrc/configuring.html#mk.conf"><code>mk.conf</code></a>, make sure that the commands of the <code>add-build-only-cflags</code> target are indented with a tab, not with spaces.)</p>
</div>
<div class="paragraph">
<p>The condition in the <code>.if</code> statement contains the <code>:U</code> modifier to prevent parse errors if the variable should be undefined, possibly because it is only defined for a subset of the packages. The <code>:M*</code> modifier ensures that there is at least one compiler option, to prevent a syntax error in the shell parser.</p>
</div>
<div class="paragraph">
<p>The code around the <code>${.TARGET}</code> variable ensures that the additional compiler options are only appended once, even if <strong>bmake build</strong> is run multiple times. To do this, it creates a marker file.</p>
</div>
<div class="paragraph">
<p>To verify that this setup works, run <strong>bmake configure</strong> in a package directory. Up to now, everything works as usual. Examine the directory
<code>work/.cwrappers/config</code> to see that the compiler options from <code>BUILD_ONLY_CFLAGS</code> are not yet added to the file <code>cc</code>. Examine the tail of the <code>work/.work.log</code> file to see that the normal compiler
options are used.</p>
</div>
<div class="paragraph">
<p>Now run <strong>bmake build</strong>. This will append the options to the file <code>cc</code> and will create the marker file in the same directory. After that, the build starts as usual, but with the added compiler options. Examine the tail of the file <code>work/.work.log</code> to see that the lines starting with
<code>[*]</code> don&#8217;t contain the compiler options, but the corresponding lines starting with <code>&lt;.&gt;</code> do end with these options.</p>
</div>
<div class="paragraph">
<p>Building packages using this setup variant and fixing the resulting bugs is the same as in <a href="https://www.netbsd.org/docs/pkgsrc/bulk.html#bulk.var.comperr">Section 8.4.2, “Detect classes of bugs by forcing compiler warnings”</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_8_4_4_use_custom_directories">8.4.4. Use custom directories</h3>
<div class="paragraph">
<p>Some directories like <code>PREFIX</code>, <code>VARBASE</code>, <code>PKG_SYSCONFDIR</code>, <code>PKGMANDIR</code>, <code>PKG_INFODIR</code> can be configured in pkgsrc. Set these to arbitrary paths during bootstrap or afterwards in <a href="https://www.netbsd.org/docs/pkgsrc/configuring.html#mk.conf"><code>mk.conf</code></a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>PREFIX=         /a-random-uuid
PKG_SYSCONFDIR= /a-random-uuid
VARBASE=        /a-random-uuid
PKGMANDIR=	a-random-uuid
PKG_INFODIR=	a-random-uuid</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_8_4_5_turn_warnings_into_errors">8.4.5. Turn warnings into errors</h3>
<div class="paragraph">
<p>When building a package, warnings are typically ignored since they just flow by and do not cause the build to fail immediately. To find these warnings, redefine them to errors in <a href="https://www.netbsd.org/docs/pkgsrc/configuring.html#mk.conf"><code>mk.conf</code></a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DELAYED_WARNING_MSG=    ${DELAYED_ERROR_MSG} "(was warning)"
WARNING_MSG=            ${FAIL_MSG} "(was warning)"</pre>
</div>
</div>
<div class="paragraph">
<p>There are many more classes of warnings in pkgsrc, and most of them can be redefined with a simple definition like above.</p>
</div>
<div class="paragraph">
<p>If a package suggests to add <code>USE_TOOLS+=perl</code> to the package Makefile, research whether the package actually needs Perl. If it does, add <code>USE_TOOLS+=perl</code> to the package Makefile, and if it doesn&#8217;t, add <code>TOOLS_BROKEN+=perl</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_8_4_6_reject_packages_for_which_pkglint_reports_errors">8.4.6. Reject packages for which pkglint reports errors</h3>
<div class="paragraph">
<p>Using pkglint as part of the regular build process is mostly a waste of time. If you want to fix some of the warnings, just run pkglint recursively on the whole pkgsrc tree. This will take a few minutes (up to 10), which is much faster than a complete bulk build.</p>
</div>
</div>
<div class="sect2">
<h3 id="_8_4_7_reject_packages_that_contain_forbidden_strings">8.4.7. Reject packages that contain forbidden strings</h3>
<div class="paragraph">
<p>To ensure that the binary packages don&#8217;t contain references to the build directory, there is already <code>CHECK_WRKREF</code>. If that variable includes the item <code>extra</code>, it is possible to define additional patterns that must not appear in any installed file. This is specified in <a href="https://www.netbsd.org/docs/pkgsrc/configuring.html#mk.conf"><code>mk.conf</code></a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HECK_WRKREF=                   extra
CHECK_WRKREF_EXTRA_DIRS+=       /usr/local
CHECK_WRKREF_EXTRA_DIRS+=       /usr/pkg
CHECK_WRKREF_EXTRA_DIRS+=	@[A-Z][A-Z]*@</pre>
</div>
</div>
<div class="paragraph">
<p>The above patterns will probably generate many false positives, therefore the results need to be taken with a grain of salt.</p>
</div>
</div>
<div class="sect2">
<h3 id="_8_4_8_reject_packages_whose_self_test_fails">8.4.8. Reject packages whose self-test fails</h3>
<div class="paragraph">
<p>To run the test suites that come with each package, add this line to <a href="https://www.netbsd.org/docs/pkgsrc/configuring.html#mk.conf"><code>mk.conf</code></a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>PKGSRC_RUN_TEST=        yes</pre>
</div>
</div>
<div class="paragraph">
<p>Be prepared that even the most basic packages fail this test. When doing a bulk build with this, it will often abort in the early phase where the packages are scanned for their dependencies since there are cyclic dependencies. There is still a lot to do in this area.</p>
</div>
</div>
<div class="sect2">
<h3 id="_8_4_9_reject_packages_that_use_undefined_shell_variables">8.4.9. Reject packages that use undefined shell variables</h3>
<div class="paragraph">
<p>To catch typos in the shell snippets from the Makefile fragments, add the <code>-u</code> flag to most of the commands by adding this line to <a href="https://www.netbsd.org/docs/pkgsrc/configuring.html#mk.conf"><code>mk.conf</code></a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>RUN=    @set -eu;</pre>
</div>
</div>
<div class="paragraph">
<p>After that, ensure that none of the bulk build log files (even those for successfully built packages) contains the string <code>parameter not set</code> or whatever error message the command <strong>sh -ceu '$undefined'</strong> outputs.</p>
</div>
<div class="paragraph">
<p>See <code>mk/misc/common.mk</code> for the existing definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="_8_4_10_turn_off_verbose_logging">8.4.10. Turn off verbose logging</h3>
<div class="paragraph">
<p>The build logs of a package are often quite long. This allows error messages or other interesting details to hide between the noise. To make
the actual error message stand out more, add these lines to <a href="https://www.netbsd.org/docs/pkgsrc/configuring.html#mk.conf"><code>mk.conf</code></a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GNU_CONFIGURE_QUIET=    yes
MAKE_FLAGS+=            -s</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-s</code> option works for both GNU Make and BSD Make. On exotic platforms with their own make, it may be a little different.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_8_5_creating_a_multiple_cd_rom_packages_collection">8.5. Creating a multiple CD-ROM packages collection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After your pkgsrc bulk-build has completed, you may wish to create a CD-ROM set of the resulting binary packages to assist in installing packages on other machines. The <a href="https://cdn.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/cdpack/index.html"><code>pkgtools/cdpack</code></a> package provides a simple tool for creating the ISO 9660 images. <strong>cdpack</strong> arranges the packages on the CD-ROMs in a way that keeps all the dependencies for a given package on the same CD as that package.</p>
</div>
<div class="sect2">
<h3 id="_8_5_1_example_of_cdpack">8.5.1. Example of cdpack</h3>
<div class="paragraph">
<p>Complete documentation for cdpack is found in the cdpack(1) man page. The following short example assumes that the binary packages are left in <code>/usr/pkgsrc/packages/All</code> and that sufficient disk space exists in <code>/u2</code> to hold the ISO 9660 images.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># mkdir /u2/images
# pkg_add /usr/pkgsrc/packages/All/cdpack
# cdpack /usr/pkgsrc/packages/All /u2/images</pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to include a common set of files(<code>COPYRIGHT</code>, <code>README</code>, etc.) on each CD in the collection, then you need to create a directory which contains these files, e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># mkdir /tmp/common
# echo "This is a README" &gt; /tmp/common/README
# echo "Another file" &gt; /tmp/common/COPYING
# mkdir /tmp/common/bin
# echo "#!/bin/sh" &gt; /tmp/common/bin/myscript
# echo "echo Hello world" &gt;&gt; /tmp/common/bin/myscript
# chmod 755 /tmp/common/bin/myscript</pre>
</div>
</div>
<div class="paragraph">
<p>Now create the images:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># cdpack -x /tmp/common /usr/pkgsrc/packages/All /u2/images</pre>
</div>
</div>
<div class="paragraph">
<p>Each image will contain <code>README</code>, <code>COPYING</code>, and <code>bin/myscript</code> in their root directories.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-07-07 06:24:23 UTC
</div>
</div>
</body>
</html>